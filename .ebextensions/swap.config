files:
  "/etc/rc.local":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Check if swap file exists
      if [ ! -f /var/swapfile ]; then
        dd if=/dev/zero of=/var/swapfile bs=8M count=256
        chmod 600 /var/swapfile
        mkswap /var/swapfile
        swapon /var/swapfile
        echo '/var/swapfile none swap sw 0 0' >> /etc/fstab
      fi

commands:
  enable_swap:
    command: |
      if [ ! -f /var/swapfile ]; then
        dd if=/dev/zero of=/var/swapfile bs=8M count=256
        chmod 600 /var/swapfile
        mkswap /var/swapfile
        swapon /var/swapfile
        echo '/var/swapfile none swap sw 0 0' >> /etc/fstab
      fi